# Linux系统基础

> 本份材料对本学期内容覆盖并不足够充分，因而仍建议看回课件！
> 
> 本课程对应的教材是於岳的《Linux实用教程》（第三版），人民邮电出版社。
> 
> 以下内容基本上整理于`重点.docx`和`Shell编程.pdf`，根据2020年实际教学情况进行修订。

## **Ch1 认识Linux系统**

**内核的版本，怎么命名的，什么是发行版，有哪些常见的发行版**

Linux的版本号分为两部分,即内核版本与发行版本。

![img](https://oss.ydjsir.com.cn/img/clip_image082.gif)

> 内核版本号由3个数字组成:r.x.y。
>
> r:目前发布的内核主版本。
>
> x:偶数表示稳定版本;奇数表示开发版本。
>
> y:错误修补的次数。

> 发行版本：一些组织和厂家,将Linux系统的内核、应用软件和文档包装起来,并提供一些系统安装界面、系统配置设定管理工具等就构成了 Linux发行版本 。
>
> 相对于Linux操作系统内核版本，各发布厂商发行版本的版本号各不相同，与Linux系统内核的版本号是相对独立的。

主流发行版：

Mandriva、Red Hat、SUSE、Debian、Ubuntu、CentOS、Arch、Gentoo等。



## **Ch2 安装Linux系统**

> 以CentOS为例
>
> 分区方案好好看看，最少有几个分区，简单的分区方案，合理的分区方案，每一个分区是干什么的

### 分区命名方案

Linux系统使用字母和数字的组合来指代硬盘分区

Linux系统使用一种更加灵活的命名方案, 该命名方案是基于文件的,文件名的格式为 /dev/xxyN, 

/dev/:这是Linux系统下所有设备文件所在的目录名。 

xx:分区名的前两个字母表示分区所在设备的类型,通常是hd(IDE硬盘)或sd(SCSI硬盘)。

y:这个字母表示分区所在的设备。

N:最后的数字N代表分区。

`/dev/sda1`   `/dev/sda2`

### 分区方案

#### 最简单的分区方案（至少需要的分区）

**SWAP分区**:即交换分区,建议大小是物理内存的1~2倍。当然你内存足够大的时候，就不需要这么做了。

**/分区**:建议大小在10GB以上。

**/boot分区**：存放与Linux启动相关程序，最少200MB

使用以上的分区方案,所有的数据都放在**/分区**上,对于系统来说不安全,数据不容易备份。

#### 合理的分区方案。6个，注意SWAP没有/且是大写

`/boot分区`:用来存放与Linux系统启动有关的程序,比如启动引导装载程序等,建议大小为100MB。 

`/usr分区`:用来存放Linux系统中的应用程序,其相关数据较多,建议大于8GB。

`/var分区`:用来存放Linux系统中经常变化的数据以及日志文件,建议大小为1GB。 

`/分区`:Linux系统的根目录,所有的目录都挂在这个目录下面,建议大小为1GB。 

`SWAP分区`:交换分区，实现虚拟内存,建议大小是物理内存的1~2倍。

> SWAP分区没有挂载点

`/home分区`:存放普通用户的数据,是普通用户的宿主目录,建议大小为剩下的空间。

#### **root的提示符、普通用户的提示符**

普通用户： $     

root用户： #

**切换为root用户：**su root

切换到普通用户it：su – it

> `-` 代表切换到该用户的用户目录下

普通用户执行root用户才能的操作：sudo 操作

## Ch3 字符界面操作基础

**两种界面：图形化界面、字符界面**

**登录 关机(shutdown) 重启(reboot)命令** **系统关机/重启：shutdown halt reboot init**

如果需要以超级管理员（root）身份登录系统进行管理，在登录提示后输入用户名为“root”，按“回车”键后，在口令提示中输入安装时设置的根口令，然后按“回车”键即可。

shutdown：安全地关闭系统

​    shutdown [选项] [时间] [警告信息]

​    shutdown -h now 立即关闭系统

​    shutdown -h 45定时45分钟后关闭系统

​    shutdown -r now重新启动系统,并发出警告信息

halt：引发主机关闭系统=调用 “shutdown —h”命令执行关闭系统 

​    [root@PC-LINUX ~]# halt

reboot：引发主机重启,参数与“halt”相似。

​     [root@PC-LINUX ~]# reboot 

init：“init”命令是所有进程的祖先,它的进程号始终为“1”,所以发送“TERM”信号给 “init”会终止所有的用户进程和守护进程等。 “init” 定义了7个运行级别,其中“init 0”为关闭系统,“init 6”为重启，通过init可以完成不同运行级别之间的切换

shutdown和init都是既可以关机又可以重启：

shutdown –h now和init 0用于关机 + halt

shutdown –r now和init 6用户重启 + reboot

### 运行级别

**要很清楚，3字符、5图形、0关机、6重启**

注意到CentOS7中已经改变了采用运行级别这样的做法，而是采用systemd和target的模式。但是事实上仍保留了一定的向前兼容性。

| 运行级别 | 对应目标          | 目标链接文件     | 功能           |
| -------- | ----------------- | ---------------- | -------------- |
| 0        | poweroff.target   | runlevel0.target | 关闭系统       |
| 1        | rescue.target     | runlevel1.target | 救援模式       |
| 2        | multi-user.target | runlevel2.target | 命令行多用户   |
| 3        | multi-user.target | runlevel3.target | 命令行多用户   |
| 4        | multi-user.target | runlevel4.target | 命令行多用户   |
| 5        | graphical.target  | runlevel5.target | 图形界面多用户 |
| 6        | reboot.target     | runlevel6.target | 重启           |

**系统日志保存在哪个目录下**

一般保存在/var/log目录下

**终端的命名tty pty pts**

tty：终端设备的统称

pty：虚拟终端

pts：pty的实现方式，与ptmx配合使用实现pty

**进入命令行的方式**

字符界面、图形界面下的终端以及虚拟控制台（远程）

**虚拟控制台的切换**

![img](https://oss.ydjsir.com.cn/img/clip_image002.gif)

![img](https://oss.ydjsir.com.cn/img/clip_image004.gif)


### **man帮助命令**

man是一种显示Unix/Linux在线手册的命令。可以用来查看命令、函数或文件的帮助手册,另外它还可以显示一些gzip压缩格式的文件。

man命令格式化并显示在线的手册页。

### help帮助命令

help使用help命令可以查找Shell命令的用法

查看mkdir命令帮助：[root@PC-LINUX ~]# mkdir --help 

（注意help前有两条-,这个是长参数）

 ### whereis命令

whereis命令可以查找命令所在的位置

**Shell里技巧性的** 

**命令行自动补全**

输入第一个之后按下Tab键

**![img](https://oss.ydjsir.com.cn/img/clip_image006.gif)** 

 

**光标上翻下翻**

[Ctrl+k]: 删除从光标到行尾的部分。
[Ctrl+u]: 删除从光标到行首的部分。
[Alt+d]: 删除从光标到当前单词结尾的部分。
[Ctrl+w]: 删除从光标到当前单词开头的部分。
[Ctrl+a]: 将光标移到行首。
[Ctrl+e]: 将光标移到行尾。
[Alt+a]: 将光标移到当前单词头部。
[Alt+e]: 将光标移到当前单词尾部。
[Ctrl+y]: 插入最近删除的单词。
[!$]: 重复前一个命令最后的参数。

**一行上执行多个命令**

**![img](https://oss.ydjsir.com.cn/img/clip_image008.gif)![img](https://oss.ydjsir.com.cn/img/clip_image010.gif)**

 

### 管道

管道可以通过组合许多小程序共同完成复杂的任务，可以将某个命令的输出信息当作某个命令的输入，由管道符号“|”来标识。

**![img](https://oss.ydjsir.com.cn/img/clip_image012.gif)**

**![img](https://oss.ydjsir.com.cn/img/clip_image014.gif)**|

more之后就可以分页显示上一个命令的输出

 

### **vi （编辑的是ASCII文本）**

#### **三种模式，三种模式之间的转换及命令**

vi编辑器有3种基本工作模式,分别是命令行模式、插入模式和末行模式。

当在Shell提示符下输入“vi文件名”之后就进入了命令行模式,在命令行模式下是不能输入任何数据的。

在命令行模式下输入文本插入命令就可以进入插入模式,这时候就可以开始输入文字了。

从插入模式切换为命令行模式只需按“Esc”键。

在命令行模式下,按转义命令冒号键“:”可以进入末行模式。

![img](https://oss.ydjsir.com.cn/img/clip_image016.gif)

命令行模式：控制屏幕光标的移动，字符、字或行的删除，移动、复制某区域及进入插入模式，或者到末行模式

注：下面操作都是只能在命令行模式下控制，在输入模式下会变成输入

#### 【屏幕光标的移动】

h j k l分别对应：左 下 上 右

Ctrl + b f u d 分别对应：

屏幕向前移动一页、向后移动一页、向前移动半页、向后移动半页

​    ![img](https://oss.ydjsir.com.cn/img/clip_image018.gif)

​     注：0和^的效果是一样的，都是所在行的行首；$是在行尾

#### 【字符、字或行的删除】

X 删除光标所在位置前面一个字符 x 删除光标所在位置的一个字符

nX 例20X，删除光标所在位置前面20个字符

nx 例6x，删除光标所在位置开始的6个字符

![../Downloads/IMG_6843.JPG](https://oss.ydjsir.com.cn/img/clip_image020.jpg)

【复制某区域】

![img](https://oss.ydjsir.com.cn/img/clip_image022.gif)

复制：y，以字为单位

【替换操作】

![img](https://oss.ydjsir.com.cn/img/clip_image024.gif)

【撤销上一次操作】u，多次u，多次撤销

【跳至指定的行】

![img](https://oss.ydjsir.com.cn/img/clip_image026.gif)

第一个g小写，第二个行后的G大写

【退出】

存盘退出：ZZ

不存盘退出：ZQ

#### 【进入插入模式】

 (仍然必须在命令行模式下，输入下面操作，光标移到这些位置，然后进入插入模式，从这些位置开始可以被编辑)

I行首  i光标当前位置  A行末  a光标下一个位置

O 光标上一行插入一行  o 光标下一行插入一行，从行首开始输

S 删除光标所在行  s 删除光标位置的一个字符

按下Insert键也可以

![../Downloads/IMG_9229.JPG](https://oss.ydjsir.com.cn/img/clip_image028.jpg)

S和dd的区别是，dd只删，S删完之后进入插入模式

#### 【进入末行模式】

确保先按“ESC”进入命令行模式，再按“：”进入末行模式

 

末行模式：将文件保存或退出编辑器，也可以设置编辑环境，如寻找字符串、列出行号等。

#### 【保存文件】

“w”:在冒号后输入字母“w”就可以将文件保存起来。

离开vi编辑器操作如下。

“q”:按“q”即退出vi,如果无法离开vi,可以在“q”后跟一个“!”强制符离开vi。

“wq”:一般建议离开时,搭配“w”一起使用,这样在退出的时候还可以保存文件。

 

## Ch4 目录和文件管理

### **常见的文件类型**

**普通文件**：文件属性符号 -  图像工具、文档工具、归档工具；

**目录文件**：文件属性符号 d  ；

**设备文件**：/dev目录下的设备文件 ；

**字符设备文件**：文件属性符号 c   接收字符流，打印机和终端；

**块设备文件**：  文件属性符号 b   随机读写，如磁盘；

**管道文件/FIFO文件**：文件属性符号p   一头流入，从另一头流出；

#### 链接连接文件

**软连接** ln –s file1/dir file2 建立，file2的ls –l时第一个是l，file1/dir属性不变，file2中包含了file1的路径；

**硬链接** ln file1 file2建立，file1和file2的ls -l 文件硬链接数均大于1，但是属性仍然不变；

后面会详解。

 ### 常见目录及其用途

| 目录         | 描述                                        |
| ------------ | ------------------------------------------- |
| /            | 根目录                                      |
| /home        | 用户目录的宿主目录，存放普通用户的数据      |
| /bin         | 存放普通的可执行命令                        |
| /sbin        | 存放root使用的系统管理程序                  |
| /dev         | 设备文件保存目录                            |
| /mnt和/media | 挂载其它文件系统系统挂载目录                |
| /boot        | 启动目录，用来存放与Linux系统启动有关的程序 |
| /proc        | 虚拟目录，系统内存映射                      |
| /opt         | 可选程序的安装目录                          |



| 目录        | 描述                           |
| ----------- | ------------------------------ |
| /var        | 存放经常变化的数据以及日志文件 |
| /etc        | 配置文件保存目录               |
| /usr        | 用来存放Linux系统中的应用程序  |
| /lost+found | 存修复或损坏的文件             |
| /srv        | 存特定服务所需文件的目录       |
| /selinux    | SELinux相关                    |



### **硬链接软链接**

#### 软链接文件

软链接又称为符号链接,这个文件包含了另一个文件/目录的路径名。 

 用“ls -l”命令查看某个文件的属性,可以看到有类似“lrwxrwxrwx”的属性符号,其属性第一个符号是“l”,这样的文件在 Linux系统中就是软链接文件。

#### 硬链接文件

硬链接是一个指针,指向文件索引节点,系统并不为它重新分配inode。可以用ln命令来建立硬链接。硬链接节省空间,也是Linux 系统整合文件系统的传统方式。 

硬链接文件有两个限制:

- 不允许给目录创建硬链接;(但是软连接中可以为一个目录创建一个快捷方式)

- 只有在同一文件系统中的文件之间才能创建硬链接。（软链接可以跨文件系统） 

#### 硬链接和软链接的区别

- 硬链接记录的是目标的inode,软链接记录的是目标的路径。

- 软链接就像是快捷方式,而硬链接就像是备份。（只要硬链接还在，你就不能真正删掉那个文件——除非你直接把他覆写）

- 软链接可以做跨分区的链接,而硬链接由于inode的缘故,只能在本分区中做链接。所以,软链接的使用频率要高得多。

##  **Ch5 Linux常用操作命令**

### **文本显示和处理命令**

`cat命令`可以显示文本文件内容,或把几个文件内容附加到另一个文件中。

`more命令`可以分页显示文本文件的内容。

`less命令`可以回卷显示文本文件的内容。

`head命令`可以显示指定文件的前若干行文件内容。

`tail命令`可以查看文件的末尾数据。

`sort命令`可以对文件中的数据进行排序,并将结果显示在标准输出上。（但是并不改变来源中的内容）

`sort –r` 倒序排序

`uniq命令`将重复行从输出文件中删除

`cut命令`可以从文件的每行中显示出选定的字节、字符或字段。

`comm命令`可以比较两个已排过序的文件,并将其结果显示出来。

`diff命令`可以逐行比较两个文本文件,列出其不同之处。它比comm命令完成更复杂的检查。它对给出的文件进行系统的检查,并显示出两个文件中所有不同的行,不要求事先对文件进行排序。

> comm是只要两个文件都包含了，就是相同的，而diff必须在同一行才相同，并且comm要排序，diff不需要

 

### **文件和命令查找命令**

**搜索grep、find什么时候用，find查文件系统**

`grep命令`可以查找文件中符合条件的字符串。

`find命令`可以将文件系统中符合条件的文件或目录列出来,可以指定文件的名称、类别、时间、大小以及权限等不同信息的组合,只有完全相符的文件才会被列出来。

`locate命令`用于在数据库中查找文件。比find命令的搜索速度快,它需要一个数据库,这个数据库由每天的例行工作(crontab)程序来建立。当建立好这个数据库后,就可以方便地搜寻所需文件了。

`whereis命令`可以查找指定文件、命令和手册页的位置。

（与man比较：显示文件、命令、函数的手册页内容）

`file命令`可以查询指定文件的文件类型。

`whatis [命令]`可以查询指定命令的功能。

`which [命令]`可以显示可执行命令的路径和它的别名。

`uname`：显示计算机及操作系统相关信息

`uname –r` //显示系统内核版本

`uname –n` //显示计算机主机名

`uname –m` //显示计算机硬件类型

`uname –a` //显示全部信息

`hostname`：显示或修改计算机主机名

`dmesg`：显示计算机开机信息

`cal`：显示日历信息

`date`：显示和设置系统日期和时间

 

### **echo显示字符串**

echo命令可以在计算机显示器上显示一段文字,一般起到一个提示的作用。 

![img](file:///C:/Users/YDJSIR-XPS15-7590/AppData/Local/Temp/msohtmlclip1/01/clip_image002.gif)

注意echo后面没有任何东西，输出所有跟在echo后的内容。即使后面的内容包含空格。

`mesg`：设置其他用户发送信息的权限

`wall`：对全部已登录用户发送信息

**![img](file:///C:/Users/YDJSIR-XPS15-7590/AppData/Local/Temp/msohtmlclip1/01/clip_image004.gif)**

`write`：向用户发送消息

`clear`：清除计算机屏幕上信息

`sync`：将缓冲区内的文件写到硬盘中

`uptime`：显示系统已经运行的时间

`last`：显示近期用户登录情况



## **Ch6 Shell编程**

该部分内容有一个单独的总结，不过貌似20年夏天并没有讲到这么难。

|                                                              |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![img](https://oss.ydjsir.com.cn/img/clip_image034.gif) | ![img](https://oss.ydjsir.com.cn/img/clip_image084.gif)<br/>![img](https://oss.ydjsir.com.cn/img/clip_image104.gif) |



| ![img](https://oss.ydjsir.com.cn/img/clip_image090.gif) |  |
| ------------------------------------------------------------ | ---- |
| ![img](https://oss.ydjsir.com.cn/img/clip_image092.gif)    |![img](https://oss.ydjsir.com.cn/img/clip_image094.gif)|


Ctrl+W 删除一个单词

！！重复上一次命令

source命令和shell scripts的区别是，source在当前bash环境下执行命令，而scripts是启动一个子shell来执行命令。这样如果把环境变量的设置命令写进scripts中，就只会影响子shell，无法改变当前的bash，所以通过文件设置环境变量时，要用source命令

**目前流行的Shell有sh，csh，ksh，tcsh和bash等** 

|      |      |
| ---- | ---- |
| ![img](https://oss.ydjsir.com.cn/img/clip_image106.gif) |   ![img](https://oss.ydjsir.com.cn/img/clip_image108.gif)   |

### Shell部分

> 具体API请看书。警告：test后面的结论如果是true的话返回的是0，不正常才返回非0的数字！等于号两端不要加多余的空格！

#### 2020所涉及到的简单的逻辑

> 注意那个引号是`。

```bash
#!/bin/bash 
#filename:bash1t.sh 输出1-5的平方
int=1
while [ $int -le 5 ]
do
sq=`expr $int \* $int`
echo $sq
int=`expr $int + 1`
done
echo "Job Done by YDJSIR!"
```

```bash
#!/bin/bash 求所有输入的数的和
#filename bash3t
sum=0
for int in $*
do
   sum=`expr $sum + $int`
done
echo $sum
```

YDJSIR此处可以给另外两种单独的实现。采用了不一样的风格，YDJSIR认为写起来更舒服。下面的例子同样提及了IO方面的API。

| 求1-n的数的和                                                | 计算1-10的平方                                               |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![image-20200822122634355](https://oss.ydjsir.com.cn/img/image-20200822122634355.png) | ![img](https://oss.ydjsir.com.cn/img/clip_image002-1598070367654.jpg) |

#### 前辈留下的高级Shell

|                                                              |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![image-20200822150230484](https://oss.ydjsir.com.cn/img/image-20200822150230484.png) | ![image-20200822150256057](https://oss.ydjsir.com.cn/img/image-20200822150256057.png) |
| ![image-20200822151632690](https://oss.ydjsir.com.cn/img/image-20200822151632690.png) | ![image-20200822151640628](https://oss.ydjsir.com.cn/img/image-20200822151640628.png) |
| ![image-20200822151649623](https://oss.ydjsir.com.cn/img/image-20200822151649623.png) | ![image-20200822151658994](https://oss.ydjsir.com.cn/img/image-20200822151658994.png) |
| ![image-20200822151720450](https://oss.ydjsir.com.cn/img/image-20200822151720450.png) | ![image-20200822151728282](https://oss.ydjsir.com.cn/img/image-20200822151728282.png) |
| ![image-20200822151736113](https://oss.ydjsir.com.cn/img/image-20200822151736113.png) | ![image-20200822151757238](https://oss.ydjsir.com.cn/img/image-20200822151757238.png) |
| ![image-20200822151807056](https://oss.ydjsir.com.cn/img/image-20200822151807056.png) | ![image-20200822151813505](https://oss.ydjsir.com.cn/img/image-20200822151813505.png) |
| ![image-20200822151822884](https://oss.ydjsir.com.cn/img/image-20200822151822884.png) | ![image-20200822151834253](https://oss.ydjsir.com.cn/img/image-20200822151834253.png) |
| ![image-20200822151844088](https://oss.ydjsir.com.cn/img/image-20200822151844088.png) | ![image-20200822151859065](https://oss.ydjsir.com.cn/img/image-20200822151859065.png) |
| ![image-20200822151920794](https://oss.ydjsir.com.cn/img/image-20200822151920794.png) | ![image-20200822152009011](https://oss.ydjsir.com.cn/img/image-20200822152009011.png) |
| ![image-20200822152052321](https://oss.ydjsir.com.cn/img/image-20200822152052321.png) | ![image-20200822152118608](https://oss.ydjsir.com.cn/img/image-20200822152118608.png) |
| ![image-20200822152253633](https://oss.ydjsir.com.cn/img/image-20200822152253633.png) | ![image-20200822152300924](https://oss.ydjsir.com.cn/img/image-20200822152300924.png) |
| ![image-20200822152315982](https://oss.ydjsir.com.cn/img/image-20200822152315982.png) | YDJSIR很清楚我们没有讲Shell里面的函数什么的。不过还是很有参考价值的。 |
|                                                              |                                                              |
|                                                              |                                                              |



## **Ch7 用户和组群账号管理**

### **用户类型**

在Linux系统中主要有root用户、虚拟用户和普通用户这3类用户。 

通过UID来标识。

root用户也被称为超级管理用户。

虚拟用户是内置用户，不具备登录系统的能力，但却是系统运行不可缺少的用户 bin，daemon，adm，ftp，mail

普通用户：只能操作自己目录内的文件

### 常用配置文件的特定行

#### /etc/passwd

是系统识别用户的一个文件,Linux系统中所有的用户都记录在该文件中。 

一行有7个段位，每个段位冒号分隔。

| 用户名 | 口令 | 用户标识号UID-唯一      | 组群标识号GID-唯一 | 用户名全称                         | 主目录 | 登录Shell |
| ------ | ---- | ----------------------- | ------------------ | ---------------------------------- | ------ | --------- |
|        |      | 确认用户权限（0是root） |                    | 用户名全称指用户名描述，可以不设置 |        |           |

#### /etc/shadow

是/etc/passwd文件的影子文件,两个文件是对应互补的。

内容包括用户及加密的口令及其他/etc/passwd不能包括的信息，比如用户账号的有限期限等。（他们的权限不同）

一行有9个段位，每个段位冒号分隔。

| 用户名 | 加密口令 | 用户最后一次更改口令的日期 | 口令允许更换前的天数 | 口令需要更换的天数 | 口令更换前警告的天数 | 账户被取消激活前的天数 | 用户账户过期日期 | 保留字段 |
| ------ | -------- | -------------------------- | -------------------- | ------------------ | -------------------- | ---------------------- | ---------------- | -------- |
|        |          |                            |                      |                    |                      |                        |                  |          |

#### /etc/group

是用户组群的配置文件

内容包括用户和用户组群,并且能显示出用户是归属哪个用户组群或哪几个用户组群。

| 组群名 | 组群口令                    | 组群标识号 | 组群成员 |
| ------ | --------------------------- | ---------- | -------- |
|        | 这里的 "x" 仅仅是密码标识， |            |          |

GID为0的组群是root组群；GID从1000开始，预留1000个 

#### /etc/gshadow

是/etc/group的加密文件,这两个文件是对应互补的。

| 组群名 | 组群口令                                    | 组管理员 | 组群成员 |
| ------ | ------------------------------------------- | -------- | -------- |
|        | 此处存储加密后的口令，如果没有设置，则为`!` |          |          |

![img](https://oss.ydjsir.com.cn/img/clip_image036.gif)![img](https://oss.ydjsir.com.cn/img/clip_image038.gif)

### 账户信息显示

`finger命令`可以显示用户账户的信息。

`groups命令`可以显示指定用户账户的组群成员身份。

`id命令可以`显示用户的ID以及该用户所属组群的GID。

`w命令`可以详细查询已登录当前计算机的用户。

`who命令`可以显示已登录当前计算机用户的简单信息。

## **Ch8 磁盘和文件系统管理**

### 分区回顾

硬盘分区一共有3种:主分区、扩展分区和逻辑分区。

Linux系统使用fdsik命令能将磁盘划分成为若干个区,同时也能为每个分区指定分区的文件系统。 

![img](https://oss.ydjsir.com.cn/img/clip_image040.gif)

#### 分区的命名

![img](https://oss.ydjsir.com.cn/img/clip_image042.gif)

硬盘类型用sd/hd/vd（虚拟盘）表示，硬盘名顺序通过abc，分区用1234表示，主分区为 1~4 中的一段，扩展分区为 2~4 分区之间的剩余。

逻辑分区是在扩展分区的再分，命名从5开始。主分区最多有4个（若多于4个，那么除了前三个剩下的必然是逻辑分区）

|                                                              |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![img](https://oss.ydjsir.com.cn/img/clip_image086.gif) | ![img](https://oss.ydjsir.com.cn/img/clip_image088.gif) |

### **文件系统**

**Linux**系统最常用的几种文件系统

1. ext3/ext4
2. JFS
3. XFS（推荐，它是CentOS所默认的分区文件系统）

![img](https://oss.ydjsir.com.cn/img/clip_image102.gif)   |   ![img](https://oss.ydjsir.com.cn/img/clip_image100.gif)   |

**创建文件系统整个过程，挂载卸载文件系统命令，自动挂载**

(1)使用fdisk命令在硬盘上创建分区。 

(2)使用mkfs命令在分区上创建文件系统。

(3)使用mount命令挂载文件系统,或修改/etc/fstab文件使得开机自动挂载文件系统。 

(4)使用umount卸载文件系统。

|                                                              |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![img](https://oss.ydjsir.com.cn/img/clip_image044.gif)<br/>![img](https://oss.ydjsir.com.cn/img/clip_image046.gif) | ![img](https://oss.ydjsir.com.cn/img/clip_image048.gif)<br/>![img](https://oss.ydjsir.com.cn/img/clip_image050.gif) |

mount命令可以将某个分区、光盘、软盘或是U盘挂载到Linux系统的目录下。 

命令语法:
`mount [选项][设备名称][挂载点]`

|                                                              |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![img](https://oss.ydjsir.com.cn/img/clip_image052.gif) | ![img](https://oss.ydjsir.com.cn/img/clip_image054.gif) |

umount命令可以将某个分区、光盘、软盘或是U盘进行卸载。

命令语法:

`umount [选项][-t <文件系统类型>][文件系统]` 

![img](https://oss.ydjsir.com.cn/img/clip_image056.gif) 

### 查看分区挂载情况

`df`

`mount –s`

`cat /etc/mtab`

### 自动挂载

/etc/fstab是一个配置文件，它包含了所有分区以及存储设备的信息。

root用户才可以编辑该文件。

可以通过修改/etc/fstab文件实现开机自动挂载文件系统。 

各段含义：

![img](https://oss.ydjsir.com.cn/img/clip_image058.gif)

1、设备名或设备UUID号 2、挂载点       3、文件系统格式  

4、挂载参数           5、转储选项  6、文件系统检查选项

## **Ch9 Linux日常管理和维护**

### RPM

RPM软件包管理器是一种开放的软件包管理系统

![img](https://oss.ydjsir.com.cn/img/clip_image128.gif)

![img](https://oss.ydjsir.com.cn/img/clip_image072.gif)

#### yum的使用

温馨提示：手动安装RPM的时候请注意你的软件包到底是同一个镜像站里面哪个分支下来的，到底是原生还是update！

### **tar命令，两组：创建压缩包，解压缩包，两种选项，每组下面各有4个字母**

使用tar命令可以将文件和目录进行打包或压缩以做备份用。

打包是指将许多文件和目录变成一个总的文件，压缩则是将一个大的文件通过一些压缩算法变成一个小文件。

Linux系统中很多压缩程序只能针对一个文件进行压缩，这样当需要压缩一大堆文件时，就得先借助其他的工具将这一大堆文件先打成一个包，然后再用原来的压缩程序进行压缩。tar+gzip  tar+bzip2

![img](https://oss.ydjsir.com.cn/img/clip_image074.gif)

## **Ch10 权限与所有者**

**有选择题，重点！权限针对哪三种用户，修改时用什么命令，用户和组。**

通过设定权限可以限制或允许以下3种用户访问:

文件的所有者、

文件所有者所在组的同组用户、

系统中的其他用户。

在Linux系统中，每种用户都有对文件或目录的读取、写入和执行权限。只有系统管理员和文件的所有者才可以更改文件或目录的权限。

|      |      |
| ---- | ---- |
|   ![img](https://oss.ydjsir.com.cn/img/clip_image060.gif)   |  ![img](https://oss.ydjsir.com.cn/img/clip_image062.gif)    |

注意到课本上还提到了两种特殊权限。

### 文件管理器更改权限

#### 文字设定法

chmod [ugoa][+-=][rwx][文件或目录名]

u表示该文件的所有者,g表示与该文件的所有者属于同一个组的用户,o表示其他用户,a表示以上三者;

+表示增加指定权限,-表示取消指定权限,= 表示设定权限等于指定权限; r表示可读取,w表示可写入,x表示表示文件 可执行或目录可进入。![img](https://oss.ydjsir.com.cn/img/clip_image064.gif) 

![img](https://oss.ydjsir.com.cn/img/clip_image066.gif)

![img](https://oss.ydjsir.com.cn/img/clip_image068.gif)

 

#### 数字设定法

  r w x - 对应数值 4读取权限 2写入权限 1可执行权限 0没有权限

​     一共三位，分别表示所有者、所在群组其它成员和其它用户的权限之和

![img](https://oss.ydjsir.com.cn/img/clip_image070.gif)

|                                                              |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![img](https://oss.ydjsir.com.cn/img/clip_image124.gif) | ![img](https://oss.ydjsir.com.cn/img/clip_image126.gif) |

#### **所有权**

`chown命令`可以更改文件和目录的所有者和用户组

`chgrp命令`可以更改文件或目录所属的组

`chgrp vboar a //更改文件a的用户组为vboar `

> ps. 系统规定新建文件默认是666权限，目录是777权限。新建文件权限=默认权限-umask权限，umask=022时，新建文件权限=666-022=644=-rw-r--r--，新建目录权限=777-022=755=drwxr-xr-x

## Ch11 Linux日常管理和维护

### **进程**

Linux系统上所有运行的内容都可以称为进程。

进程是在自身的虚拟地址空间运行的一个单独的程序。

作业是一系列按一定顺序执行的命令。

三种进程：交互式进程、批处理进程、守护进程

**进程查看**

`ps命令`是最基本同时也是非常强大的进程查看命令。

使用该命令可以确定有哪些进程正在运行以及进程运行的状态、进程是否结束,进程有没有僵死,哪些进程占用了过多的资源等。

使用ps命令可以用于监控后台进程的工作情况。

![img](https://oss.ydjsir.com.cn/img/clip_image076.gif)

`top命令`：显示当前正运行的进程及重要信息,包括它们的内存和CPU用量。（它其实是多种功能的复合，可以视作Windows的任务管理器）

**进程停止**

终止前台命令,[Ctrl+C]键

终止后台进程, kill命令

  先用ps命令获得进程号，然后用kill命令终止

不能终止,可使用更有效的kill -9命令

`kill -9 5975`：强制杀死进程号为5975的进程 

**进程启动**

两种途径：手工启动和调度启动

1.手工启动

(1)前台启动

(2)后台启动—在命令结尾加上一个 “&”号

2.调度启动

  事先进行设置，根据用户要求自行启动。任务可以被配置在指定的时间、指定的日期或系统平均负载量低于指定的数量时自动运行

**进程挂起与恢复**

挂起：[Ctrl+Z]键

显示shell作业清单：jobs命令

恢复：`fg`命令将挂起的作业放回前台执行

`bg`命令将挂起的作业放回后台执行

### **任务计划**

在固定的时间上触发某个作业,需要创建任务计划,按时执行该作业cron和at

cron命令被用来调度重复的任务

at命令被用来在指定时间内调度一次性的任务

1.cron实现自动化

（1）/etc/crontab文件实现

cron守护进程可在无需人工干预的情况下调度执行重复任务的守护进程

文件格式：分钟 小时 日期 月份 星期 执行的命令

（2）crontab命令实现

  crontab [-u 用户名] –e //root用户创建或编辑crontab

crontab [-u 用户名] –l //root用户列出crontab文件

crontab [-u 用户名] –r //root用户删除crontab文件

crontab –e       //普通用户创建或编辑crontab

  crontab –l       //普通用户列出crontab文件

  crontab –r       //普通用户删除crontab文件

  crontab <filename>   //恢复丢失的crontab文件

编辑和创建的命令是一样的。但是编辑时root用户多了一个用vi直接编辑/var/pool/cron/<username>文件的选择，普通用户是打不开的。

2.使用at实现自动化

△一旦一个作业被提交，at命令将会保留所有当前的环境变量，包括路径，该作业的所有输出都将以电子邮件的形式发送给用户。

![img](https://oss.ydjsir.com.cn/img/clip_image078.gif)

△ 和crontab一样，root用户可以通过/etc目录下的at.allow和at.deny文件来控制哪些用户可以使用at命令

 

### **系统启动**

1.BIOS自检

计算机在接通电源之后首先由BIOS进行POST自检，然后依据BIOS内设置的引导顺序从硬盘、软盘或CDROM中读入引导块

2.启动GRUB 2 

GRUB 2 是引导加载程序，用于引导操作系统启动

3.加载内核 

加载内核映像到内存中

4.执行systemd进程

systemd进程是系统所有进程的起点，内核在完成核内引导之后，即在本进程空间内加载systemd程序，它的进程号是1

5.执行/bin/login程序

 login程序会提示使用者输入账号及密码，接着编码并确认密码的正确性， 如果账号与密码相符，则为使用者初始化环境，并将控制权交给shell，即

 等待用户登录。

### 维护GRUB

这部分还是看课本吧，当时实操的时候也出现了一大堆问题。


## **Ch12 Linux网络基本配置**

### **网络命令**

**![img](https://oss.ydjsir.com.cn/img/clip_image080.gif)**

**netstat：显示**网络状态**信息**

arp：增加、删除和显示arp缓存

**tcpdump：**可以监视TCP/IP连接,并直接读取数据链路层的数据包头,可以指定哪些数据包被监视以及哪些控制要显示格式（抓包）

 

### **管理网络服务的3种方式**

启动或停止Linux系统服务

#### ntsysv:基于TUI的程序

它允许为每个运行级别配置引导时要启动的服务。

对于独立服务而言,改变不会立即生效。

<img src="https://oss.ydjsir.com.cn/img/image-20200822090704417.png" alt="image-20200822090704417" style="zoom:50%;" />

#### systemctl命令

```bash
systemctl 选项 [服务名].service  `.service` 可以省略。
```

命令中各选项的含义如下。

`start`:表示启动服务。

`stop`:表示停止服务。

`status`:表示查看服务状态。

`restart`:表示重新启动服务。

`reload`:表示加载服务配置文件。

`enable`:表示开机自动启动服务。

`disable`:表示开机禁止启动服务。

`is-enabled`:表示查看服务是否开机自动启动。

```bash
list-units --type=service:显示所有已启动的服务。
```

#### chkconfig和service命令

 允许在不同运行级别启动和关闭服务的命令行工具

 `service命令`控制服务可以马上生效

 `chkconfig命令`控制服务需要等计算机重新启动后才会生效

### **提高Linux系统安全性的一些方法**

|                      |                                   |
| -------------------- | --------------------------------- |
| 部署防火墙           | 关闭不用的服务和端口              |
| 严格禁止设置默认路由 | 口令管理                          |
| 分区管理             | 防范网络嗅探                      |
| 完整的日志管理       | 使用安全工具软件（比如说SELinux） |
| 使用保留的IP地址     | 部署Linux防病毒软件               |
| 加强登录安全         | 安装补丁                          |

## **Ch13 远程连接服务器配置**

使用ssh命令允许用户在远程计算机上登录并执行相关命令。

VNC，虚拟网络计算，可以用图形界面的方式连接到远程服务器，以达到远程控制。

配置NFS服务器可以让客户端挂载服务器上的共享目录，可以很方便地实现在同一网络上的多个用户间共享目标。

### ssh

`ssh -l [用户名] [远程主机IP地址]`

或ssh [用户名]@[远程主机IP地址]

### scp

把本地文件传输到远程主机：

`scp [本地文件] [用户名@远程主机IP地址:/目标文件]`

把远程文件传输到本地主机：

`scp [用户名@远程主机IP地址:/源文件] [本地文件]`

### sftp

这个好像我们没见到。

sftp [用户名@远程主机IP地址]

## Ch14 NFS服务器配置

字符界面配置NFS服务器

（1） 在NFS服务器的主要配置文件/etc/exports中加一行：

```bash
[共享目录] [主机] (参数) 
```

目录是要共享的目录；主机：限定哪些计算机可以访问。主机名或是该计算机的IP地址/使用通配符指定的域名/IP网络/Netgroups；参数如 rw,sync…

## 补充内容：LVM逻辑卷

 Logical Volume Manager，逻辑卷管理

- 它是Linux环境下对磁盘分区进行管理的一种机制
- 屏蔽了底层磁盘布局，便于动态调整磁盘容量
- 需要注意：/boot分区用于存放引导文件，不能应用LVM机制，类似地，/boot分区不能用软RAID！

### LVM机制的基本概念

### PV（Physical Volume，物理卷）

整个硬盘，或使用fdisk等工具建立的普通分区，包括许多默认4MB（这个值可以设置）大小的PE（Physical Extent，基本单元）
### VG（Volume Group，卷组）
一个或多个物理卷组合而成的整体。

### LV（Logical Volume，逻辑卷）

从卷组中分割出的一块空间，用于建立文件系统。

![image-20200822094152098](https://oss.ydjsir.com.cn/img/image-20200822094152098.png)

|                                                              |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![image-20200822094245280](https://oss.ydjsir.com.cn/img/image-20200822094245280.png) | ![image-20200822094255897](https://oss.ydjsir.com.cn/img/image-20200822094255897.png)<br/>![image-20200822094307239](https://oss.ydjsir.com.cn/img/image-20200822094307239.png) |

### 创建LVM分区

#### 新建空分区

这一部分和前面磁盘管理那边一模一样，就是新建个普通分区。用fdisk。

#### 初始化分区（创建PV物理卷）

```bash
pvcreate [设备名]
```

#### 创建卷组

```bash
vgcreate –s [块大小] [卷组名] [物理卷] [设备名]
```

#### 创建逻辑卷

```bash
lvcreate -n [逻辑卷名] –L [逻辑卷大小] [已存在卷组名]
```

> 把大写的L换成小写的L时，后面逻辑卷大小对应的填VG中块的个数。当然无论如何，到最后大小都会是逻辑卷大小的整数倍。

#### 创建文件系统及挂载

这一部分和前面的一样。但是请注意逻辑卷的设备名。它是`/dev/[卷组名]/逻辑卷名` ！

### 管理逻辑卷

扩大/缩小：请注意操作顺序！

扩大时**先扩大逻辑卷**，然后**再扩大文件系统空间**；缩小时**先缩小文件系统空间**，**后缩小逻辑卷**（如果有必要的话）**缩空间有风险，操作需谨慎**！

![image-20200822100109887](https://oss.ydjsir.com.cn/img/image-20200822100109887.png)

```bash
lvextend -L +[大小] /dev/[卷组名]/[逻辑卷名]
lvreduce -L +[大小] /dev/[卷组名]/[逻辑卷名]
```

```bash
resize2fs –p /dev/[卷组名]/[逻辑卷名]
```

注意到缩小文件系统时必须要先将逻辑卷卸载并确定数据使用量！（扩大文件系统时不用）

```bash
umount /dev/[卷组名]/[逻辑卷名]
fsck -f /dev/[卷组名]/[逻辑卷名]
```

### 快照卷

快照是临时保留所更改的逻辑卷的原始数据的逻辑卷。快照提供原始卷的静态视图，从而能够以一致状态备份其数据。**但是快照本身是不断地在变化的**。

#### 确定快照的大小

1. 预期更改率 2. 所需快照时间

```bash
lvcreate –s –n snaplv–L 20M /dev/vgname/lvname
mkdir/snapmount
mount –ro /dev/vgname/snaplv/snapmount
# 验证快照状态
lvscan /dev/vgname/lvname
# 卸载快照
umount /snapmount
lvremove /dev/vgname/lvname
```

